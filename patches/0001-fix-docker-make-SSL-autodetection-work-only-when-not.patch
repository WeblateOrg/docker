From 0383aae884203b77a218a57a34cb90bbb6196119 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Tue, 16 Dec 2025 16:00:59 +0100
Subject: [PATCH 1/1] fix(docker): make SSL autodetection work only when not
 configured

Fixes WEBLATE-38AQ
---
 docs/changes.rst           |  4 ++++
 weblate/settings_docker.py | 14 +++++++++-----
 2 files changed, 13 insertions(+), 5 deletions(-)

diff --git a/weblate/settings_docker.py b/weblate/settings_docker.py
index 2d3e7f8e1c..2d00d9bf40 100644
--- a/weblate/settings_docker.py
+++ b/weblate/settings_docker.py
@@ -1337,11 +1337,15 @@ elif EMAIL_USE_TLS:
     DEFAULT_EMAIL_PORT = 465
 EMAIL_PORT = get_env_int("WEBLATE_EMAIL_PORT", DEFAULT_EMAIL_PORT)

-# Detect SSL/TLS setup
-if not EMAIL_USE_TLS and EMAIL_PORT in {25, 587}:
-    EMAIL_USE_TLS = True
-elif not EMAIL_USE_SSL and EMAIL_PORT == 465:
-    EMAIL_USE_SSL = True
+# Detect SSL/TLS setup if not explicitly stated
+if (
+    "WEBLATE_EMAIL_USE_SSL" not in os.environ
+    and "WEBLATE_EMAIL_USE_TLS" not in os.environ
+):
+    if not EMAIL_USE_TLS and EMAIL_PORT in {25, 587}:
+        EMAIL_USE_TLS = True
+    elif not EMAIL_USE_SSL and EMAIL_PORT == 465:
+        EMAIL_USE_SSL = True

 EMAIL_BACKEND = get_env_str(
     "WEBLATE_EMAIL_BACKEND",
--
2.47.3
